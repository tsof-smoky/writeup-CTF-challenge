![[Pasted image 20220701171825.png]]

The attached PCAP belongs to an Exploitation Kit infection. Analyze it using your favorite tool and answer the challenge questions.

**Tools:**

-   [BrimSecurity](https://www.brimsecurity.com/)
-   [suricatarunner](https://github.com/brimsec/build-suricata/releases/tag/v5.0.3-brim1)
-   [suricata.rules](https://download.cyberdefenders.org/BlueYard/misc/suricata.zip)
-   [NetworkMiner](https://www.netresec.com/?page=networkminer)
-   [WireShark](https://www.wireshark.org/)

---

1. What is the IP address of the infected Windows host?
```
event_type=="alert" | alerts := union(alert.category) by src_ip, dest_ip
```
Importing the pcap file into Brim, we will realize some interesting things:
![[Pasted image 20220701171939.png]]
Pivot to logs:
![[Pasted image 20220701172037.png]]
Packet details:
![[Pasted image 20220701172344.png]]

>Answer: 192.168.137.62

---

2. What is the Exploit kit (EK) name? (two words)

Upload to [PacketTotal](https://packettotal.com/app/analysis?id=279b41e48bbd743a1b0a2ef00ae87016) and everything will be much simpler

![[Pasted image 20220701173007.png]]

>Answer:  Angler EK

---

3. What is the FQDN that delivered the exploit kit?

Upload to [VirusTotal](https://www.virustotal.com/gui/file/6ba80e45e35260a70899b1d79ea7965deae621a2851aa6eec56aa122c23dd133/details), I noticed in the section **Interesting HTTP Requests** there is some interesting information.

![[Pasted image 20220701194807.png]]

On the first request, a request is sent to *http[://]adstairs[.]ro/* ( **93.114.64.118**) to download a file with the Hash code `f4e0c392b0249bd307b818cffa8a5b8ee5259a44fa0405f445e279da7e1206e6`. This is a Flash file (you can learn more via Google). In addition, it is referring to a suspicious address *http[://]www[.]earsurgery[.]org/*.

![[Pasted image 20220701201015.png]]

The next two requests are to the server *http[://]qwe[.]mvdunalterableairreport[.]net/* with the IP address **192.99.198.158**. While the first request is to download a Flash file ( `9ab41d23faf07b25e378489e585ff83d39a10a6ff5eca5b7bb96f321992ce744` ) and refer to another address ( *http[://]qwe[.]mvdunalterableairreport[.]net/3xdz3bcxc8* ), the last request downloads a compressed zip file (` 5624d9b8b73b0bfe1cb891615520bd6d7f50cc48ad4e6bcb03671015fcbd86e0 `).

![[Pasted image 20220701201036.png]]
![[Pasted image 20220701201050.png]]

When I dig into more details about zip files on virustotal, I noticed a name related to the Exploit Kit we mentioned above.

![[Pasted image 20220701201304.png]]

```
_path=="http" id.resp_h==192.99.198.158 | cut id.orig_h, id.resp_h, id.resp_p, method, host, uri | uniq -c
```

![[Pasted image 20220701201545.png]]

>Answer: qwe[.]mvdunalterableairreport[.]net 

---

4.What is the redirect URL that points to the exploit kit landing page?
```
_path=="http" id.resp_h==192.99.198.158 | cut ts,id.orig_h, id.resp_h, id.resp_p,referrer, method, host, uri | sort ts
```
![[Pasted image 20220701203306.png]]

From this we can conclude that before being navigated to the exploit kit landing page, the victim visited another URL.

>Answer: http[://]lifeinsidedetroit[.]com/02024870e4644b68814aadfbb58a75bc.php?q=e8bd3799ee8799332593b0b9caa1f426 

---

5.  What is the FQDN of the compromised website?

```
_path=="http" id.orig_h==172.16.165.132 | cut id.orig_h, id.resp_h, host, method, referrer, ts, resp_mime_types | sort ts
```

![[Pasted image 20220627143018.png]]

>Answer: earsurgery.org

---

6. What is the FQDN of the compromised website?

>Answer: hijinksensue.com

---

7. What is the name exploit kit (EK) that delivered the malware? (two words)

[PacketTotal](https://packettotal.com/)

![[Pasted image 20220627143651.png]]

>Answer: Sweet Orange 

---

8. What is the redirect URL that points to the exploit kit landing page?

![[Pasted image 20220627144131.png]]

>Answer: static[.]charlotteretirementcommunities[.]com/k?tstmp=3701802802 

---

9. What is the IP address of the redirect URL that points to the exploit kit landing page?

```
_path=="http" | cut ts, id.orig_h,id.resp_h,host,referrer, uri,resp_filenames,resp_mime_types | sort ts
```

![[Pasted image 20220627144311.png]]

>Answer:  50.87.149.90 

---

10. Extract the malware payload (PE file) from the PCAP. What is the MD5 hash?

```
_path=="files" source=="HTTP" 37.143.15.180 in tx_hosts | cut tx_hosts, rx_hosts, md5, mime_type
```
![[Pasted image 20220627144446.png]]
![[Pasted image 20220627144534.png]]

>Answer: 1408275c2e2c8fe5e83227ba371ac6b3

---

11. What is the CVE of the exploited vulnerability?

Search: Sweet Orange CVE

![[Pasted image 20220627144834.png]]

>Answer: CVE-2014-6332 

---

12. What is the mime-type of the file that took the longest time (duration) to be analyzed using Zeek?

```
files | sort -r duration
```

![[Pasted image 20220627150836.png]]

>Answer: application/x-dosexec

---

13. What was the referrer for the visited URI that returned the file "f.txt"?

From Brim, check File Activity
```
filename!=null | cut _path, tx_hosts, rx_hosts, conn_uids, mime_type, filename, md5, sha1
```

![[Pasted image 20220627150137.png]]

Then, direct to WireShark

![[Pasted image 20220627150051.png]]

>Answer: http[:]//hijinksensue.com/assets/verts/hiveworks/ad1.html 

---

14. When was this PCAP captured?

![[Pasted image 20220627150700.png]]

>Answer: 23/11/2014 

---

15.  	When was the PE file compiled?

[VirusTotal](https://www.virustotal.com/gui/file/cc185105946c202d9fd0ef18423b078cd8e064b1e2a87e93ed1b3d4f2cbdb65d/details)

![[Pasted image 20220627150948.png]]

>Answer: CVE-2014-6332 

---

16. What is the name of the SSL certificate issuer that appeared only once? (one word)

```
_path=="ssl" | cut issuer
```

![[Pasted image 20220627151219.png]]

>Answer: Cybertrust

---

17. What were the two protection methods enabled during the compilation of the present PE file? Format: comma-separated in alphabetical order

![[Pasted image 20220627151328.png]]

>Answer: DEP,SEH 


![[Pasted image 20220627155648.png]]

I wish you a good day!
