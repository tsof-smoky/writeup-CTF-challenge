![[Pasted image 20220621102223.png]]

The attached PCAP belongs to an Exploitation Kit infection. Analyze it using your favorite tool and answer the challenge questions.

**Tools:**

-   [BrimSecurity](https://www.brimsecurity.com/)
-   [suricatarunner](https://github.com/brimsec/build-suricata/releases/tag/v5.0.3-brim1)
-   [suricata.rules](https://download.cyberdefenders.org/BlueYard/misc/suricata.zip)
-   [NetworkMiner](https://www.netresec.com/?page=networkminer)
-   [WireShark](https://www.wireshark.org/)

---

1. What is the IP address of the Windows VM that gets infected?

After downloading and decompressing, I have a pcap file as shown below:

![[Pasted image 20220621104228.png]]

Importing the pcap file into Brim and WireShark, we will realize some interesting things:
![[Pasted image 20220621104540.png]]
![[Pasted image 20220621104646.png]]
Pivot to logs:
![[Pasted image 20220621110615.png]]

More information: [Suricata_rules](https://github.com/OISF/suricata-update/blob/0a8fddd331d744c853e49001e50757bab702bad0/tests/emerging-current_events.rules#L2661)
Packet details:
![[Pasted image 20220621110419.png]]

>Answer: 172.16.165.165

---

2. What is the hostname of the Windows VM that gets infected?

From WireShark, filter by protocol ***dhcp*** and go to DHCP Request, we will find the answer in the data section.

![[Pasted image 20220621104950.png]]


>Answer: K34EN6W3N-PC

---

3. What is the MAC address of the infected VM?

Similar to the above, we will also easily find out the device's MAC address:

![[Pasted image 20220621105230.png]]

>Answer: f0:19:af:02:9b:f1

---

4. What is the IP address of the compromised web site?

Now that I have the ip of the infected machine, I will find information about ***http***:
```
_path=="http" id.orig_h==172.16.165.165 | count() by host, id.resp_h
```
![[Pasted image 20220621111345.png]]

Then I filter for valuable information about links to suspicious websites:
```
_path=="http" id.orig_h==172.16.165.165 | cut id.orig_h, id.resp_h, host, method, referrer, ts, resp_mime_types | sort ts
```

![[Pasted image 20220621111901.png]]

On the first event, the victim machine searched for ciniholland[.]nl on the Bing search engine:

![[Pasted image 20220621112130.png]]

The victim machine is then redirected to ciniholland[.]nl via another website adultbiz[.]in

![[Pasted image 20220621112349.png]]

The victim machine continues to be redirected to ciniholland[.]nl through another website, 24corp-shop[.]com

![[Pasted image 20220621112643.png]]

Finally, the victim machine accesses stand[.]trustandprobaterealty[.]com through the website 24corp-shop[.]com

![[Pasted image 20220621112905.png]]
We can summarize the infection process as follows:
![[Pasted image 20220621114303.png]]

>Answer: 82.150.140.30

---

5. What is the FQDN of the compromised website?

>Answer: ciniholland.nl

---

6. What is the IP address of the server that delivered the exploit kit and malware?

We will test suricata's query - **Suricata Alerts by Category**
```
event_type=="alert" | alerts := union(alert.category) by src_ip, dest_ip
```
![[Pasted image 20220621114413.png]]
Pivot to logs:
```
src_ip==37.200.69.143 dest_ip==172.16.165.165 | cut event_type,src_ip,dest_ip,alert.severity, alert.signature,alert.category | sort ts
```
![[Pasted image 20220621114927.png]]
![[Pasted image 20220621115220.png]]
>Answer: 37.200.69.143

---

7. What is the FQDN that delivered the exploit kit and malware?


>Answer: stand.trustandprobaterealty.com

---

8. What is the redirect URL that points to the exploit kit (EK) landing page?

>Answer:  http://24corp-shop[.]com/

---

9. Other than CVE-2013-2551 IE exploit, another application was targeted by the EK and starts with "J". Provide the full application name.

```
event_type=="alert" | count() by alert.signature | sort -r
```
![[Pasted image 20220621115433.png]]

>Answer: Java

---

10. How many times was the payload delivered?


![[Pasted image 20220621115627.png]]
>Answer: 3

---

12. The compromised website has a malicious script with a URL. What is this URL?

```
_path=="http" host=="www.ciniholland.nl" | sort ts
```
![[Pasted image 20220621120032.png]]
Select the first packet and in the top right corner will appear the icon of WireShark, select to open the packet details:
![[Pasted image 20220621120216.png]]
Follow TCP Stream:
![[Pasted image 20220621115946.png]]
Above we can see that the malicious website contains a malicious script containing the url that navigates to 24corp-shop[.]com, the attribute is ***visibility:hidden***
![[Pasted image 20220621120607.png]]
>Answer: http://24corp-shop[.]com/

---

13. Extract the two exploit files. What are the MD5 file hashes? (comma-separated )
```
_path=="files" source=="HTTP" 37.200.69.143 in tx_hosts | cut tx_hosts, rx_hosts, md5, mime_type
```
![[Pasted image 20220621120756.png]]
![[Pasted image 20220621120911.png]]
![[Pasted image 20220621120939.png]]
>Answer: 7b3baa7d6bb3720f369219789e38d6ab,1e34fdebbf655cebea78b45e43520ddf

![[Pasted image 20220621121144.png]]

I wish you a good day!

